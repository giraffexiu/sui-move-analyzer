# 实现计划

- [x] 1. 创建核心数据结构和错误类型
  - 定义 FunctionAnalysis、LocationInfo、Parameter、FunctionCall 等数据结构
  - 实现 AnalyzerError 错误类型和相关的错误处理
  - 添加 JSON 序列化支持
  - _需求: 1.1, 2.1, 6.1, 6.4_

- [x] 2. 实现项目加载器 (ProjectLoader)
  - [x] 2.1 创建 ProjectLoader 结构体和基本接口
    - 实现 load_project 方法来加载 Sui Move 项目
    - 集成现有的 Project::new 功能
    - _需求: 1.1, 1.2, 1.3_

  - [x] 2.2 实现项目验证功能
    - 验证 Move.toml 文件存在性和有效性
    - 检查项目目录结构的完整性
    - 返回详细的验证错误信息
    - _需求: 1.1, 1.4_

  - [x] 2.3 编写项目加载器的单元测试
    - 测试有效项目的加载
    - 测试无效项目路径的错误处理
    - 测试 Move.toml 解析错误的处理
    - _需求: 1.1, 1.4_

- [x] 3. 实现函数解析器 (FunctionParser)
  - [x] 3.1 创建 FunctionParser 结构体
    - 实现基于函数名称的搜索功能
    - 利用现有的 ProjectContext 和符号表
    - 支持在多个模块中查找同名函数
    - _需求: 2.1, 2.2, 2.3_

  - [x] 3.2 实现函数签名提取
    - 解析函数参数和返回类型
    - 处理泛型函数的类型参数
    - 生成标准化的函数签名字符串
    - _需求: 4.1, 4.2, 4.4, 7.3_

  - [x] 3.3 实现源代码提取功能
    - 从 AST 节点提取完整的函数源代码
    - 保持原始格式和缩进
    - 包含函数的文档注释
    - 计算准确的行号范围
    - _需求: 3.1, 3.2, 3.3, 3.4_

  - [x] 3.4 编写函数解析器的单元测试
    - 测试函数查找功能
    - 测试函数签名提取的准确性
    - 测试源代码提取的完整性
    - _需求: 2.1, 2.4, 3.1_

- [x] 4. 实现调用分析器 (CallAnalyzer)
  - [x] 4.1 创建 CallAnalyzer 结构体
    - 实现函数体内的调用识别
    - 遍历 AST 表达式树查找函数调用
    - _需求: 5.1, 5.2_

  - [x] 4.2 实现调用目标解析
    - 解析直接函数调用 (function_name)
    - 解析方法调用语法 (object.method)
    - 解析模块限定调用 (module::function)
    - 区分内置函数和用户定义函数
    - _需求: 5.2, 5.3, 5.5, 7.2_

  - [x] 4.3 实现调用信息提取
    - 提取被调用函数的模块和文件位置
    - 生成调用函数的签名信息
    - 处理外部依赖模块的调用
    - _需求: 5.2, 5.3_

  - [x] 4.4 编写调用分析器的单元测试
    - 测试各种调用语法的识别
    - 测试调用目标解析的准确性
    - 测试空调用情况的处理
    - _需求: 5.1, 5.4, 5.5_

- [ ] 5. 实现类型解析器 (TypeResolver)
  - [x] 5.1 创建类型解析功能
    - 解析基本 Move 类型 (u8, u64, bool, address 等)
    - 处理引用类型 (&T, &mut T)
    - 解析结构体类型和泛型类型
    - _需求: 4.1, 4.2, 4.4, 7.3_

  - [x] 5.2 实现复杂类型处理
    - 处理嵌套的泛型类型
    - 解析 Move 资源类型
    - 生成可读的类型字符串表示
    - _需求: 4.2, 7.3_

  - [x] 5.3 编写类型解析器的单元测试
    - 测试各种 Move 类型的解析
    - 测试复杂泛型类型的处理
    - 测试类型字符串生成的正确性
    - _需求: 4.1, 4.2, 4.4_

- [x] 6. 实现主要分析器接口 (FunctionAnalyzer)
  - [x] 6.1 创建 FunctionAnalyzer 主结构体
    - 整合 ProjectLoader、FunctionParser、CallAnalyzer 等组件
    - 实现 new 方法来初始化分析器
    - 处理项目加载和初始化错误
    - _需求: 1.1, 1.2, 1.3_

  - [x] 6.2 实现 analyze_function 主方法
    - 协调各个组件完成完整的函数分析
    - 处理多个同名函数的情况
    - 实现错误恢复和部分结果返回
    - _需求: 2.1, 2.2, 2.3, 2.4_

  - [x] 6.3 实现 JSON 格式化输出
    - 将分析结果转换为指定的 JSON 格式
    - 处理特殊字符的转义
    - 确保输出格式与需求规范一致
    - _需求: 6.1, 6.2, 6.3_

  - [x] 6.4 编写主接口的集成测试
    - 使用真实 Move 项目进行端到端测试
    - 测试完整的分析工作流
    - 验证 JSON 输出格式的正确性
    - _需求: 6.1, 6.2, 6.3_

- [x] 7. 实现 Move 语法特性支持
  - [x] 7.1 支持各种函数定义类型
    - 处理 public、public(friend)、entry、native 函数
    - 正确识别函数的可见性修饰符
    - _需求: 7.1, 7.2_

  - [x] 7.2 实现 Move 特定语法处理
    - 支持 Move 的方法调用语法 (点符号)
    - 处理 Move 的模块系统和导入
    - 识别 Move 特定的关键字和语法结构
    - _需求: 7.1, 7.2, 7.4_

  - [x] 7.3 编写 Move 语法特性测试
    - 测试各种函数定义类型的处理
    - 测试 Move 特定语法的识别
    - 验证模块系统的正确处理
    - _需求: 7.1, 7.2, 7.4_

- [x] 8. 创建命令行接口和示例
  - [x] 8.1 实现命令行工具
    - 创建可执行的命令行程序
    - 支持项目路径和函数名称参数
    - 提供友好的错误消息和帮助信息
    - _需求: 1.1, 2.1, 6.1_

  - [x] 8.2 创建使用示例和文档
    - 编写使用说明和 API 文档
    - 提供典型使用场景的示例代码
    - 创建测试用的示例 Move 项目
    - _需求: 6.1, 6.2_

  - [ ]* 8.3 编写端到端测试
    - 使用现有测试项目验证功能
    - 测试命令行工具的各种使用场景
    - 验证与现有 Move 项目的兼容性
    - _需求: 1.1, 2.1, 6.1_